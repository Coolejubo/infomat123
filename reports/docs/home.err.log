Traceback (most recent call last):
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/client.py", line 1204, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/util.py", line 84, in wrapped
    return just_run(coro(*args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/util.py", line 62, in just_run
    return loop.run_until_complete(coro)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/asyncio/base_events.py", line 653, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/client.py", line 663, in async_execute
    await self.async_execute_cell(
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/client.py", line 965, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/homebrew/Caskroom/miniconda/base/envs/jupyterbook/lib/python3.11/site-packages/nbclient/client.py", line 862, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
def create_sunburst_plot(df, education_col, drug_cols, subplot_titles):
    # Creating a subplot figure with 1 row and 2 columns
    fig = make_subplots(rows=1, cols=2, specs=[[{"type": "sunburst"}, {"type": "sunburst"}]])

    # Hover template
    hover_template = '<b>%{label}:</b> %{percentParent:.1%}'

    # Adding sunbursts to the figure
    for i, drug_col in enumerate(drug_cols):
        fig_sunburst = px.sunburst(df, path=[education_col, drug_col])
        fig.add_trace(go.Sunburst(fig_sunburst.data[0], hovertemplate=hover_template), row=1, col=i+1)
    
    # Adding titles for subplots
    annotations = [
        dict(text=subplot_titles[0], x=0.205, y=-0.15, xref='paper', yref='paper', showarrow=False, font=dict(size=15)),
        dict(text=subplot_titles[1], x=0.8, y=-0.15, xref='paper', yref='paper', showarrow=False, font=dict(size=15))
    ]

    # Updating the layout and showing the figure
    fig.update_layout(title_text=f"Drug Use Across {education_col} Education Levels",
                      grid={"rows": 1, "columns": 2},
                      annotations=annotations,
                      legend=dict(
                          orientation="h",
                          yanchor="bottom",
                          y=1.02,
                          xanchor="right",
                          x=1
                      ))

    fig.show()

# Read the data
df = pd.read_csv('nsduh_workforce_adults.csv')

# Define the mapping for drugs and educations
drug_labels = {1: 'Used', 0: 'Did Not Use'}

# First Plot
education_labels_detailed = {1: "No high school", 2: "High school", 3: "Associate degree", 4: "College degree"}
df['education_detailed'] = df['education'].map(education_labels_detailed)
df['crack_ever_bool'] = df['crack_ever'].map(drug_labels)
df['heroin_ever_bool'] = df['heroin_ever'].map(drug_labels)

create_sunburst_plot(df, 'education_detailed', ['crack_ever_bool', 'heroin_ever_bool'], ['Crack', 'Heroin'])

# Second Plot
education_labels_simple = {1: "Lower", 2: "Lower", 3: "Higher", 4: "Higher"}
df['education_simple'] = df['education'].map(education_labels_simple)

create_sunburst_plot(df, 'education_simple', ['crack_ever_bool', 'heroin_ever_bool'], ['Crack', 'Heroin'])
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mNameError[0m                                 Traceback (most recent call last)
Cell [0;32mIn[7], line 45[0m
[1;32m     42[0m df[[38;5;124m'[39m[38;5;124mcrack_ever_bool[39m[38;5;124m'[39m] [38;5;241m=[39m df[[38;5;124m'[39m[38;5;124mcrack_ever[39m[38;5;124m'[39m][38;5;241m.[39mmap(drug_labels)
[1;32m     43[0m df[[38;5;124m'[39m[38;5;124mheroin_ever_bool[39m[38;5;124m'[39m] [38;5;241m=[39m df[[38;5;124m'[39m[38;5;124mheroin_ever[39m[38;5;124m'[39m][38;5;241m.[39mmap(drug_labels)
[0;32m---> 45[0m create_sunburst_plot(df, [38;5;124m'[39m[38;5;124meducation_detailed[39m[38;5;124m'[39m, [[38;5;124m'[39m[38;5;124mcrack_ever_bool[39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124mheroin_ever_bool[39m[38;5;124m'[39m], [[38;5;124m'[39m[38;5;124mCrack[39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124mHeroin[39m[38;5;124m'[39m])
[1;32m     47[0m [38;5;66;03m# Second Plot[39;00m
[1;32m     48[0m education_labels_simple [38;5;241m=[39m {[38;5;241m1[39m: [38;5;124m"[39m[38;5;124mLower[39m[38;5;124m"[39m, [38;5;241m2[39m: [38;5;124m"[39m[38;5;124mLower[39m[38;5;124m"[39m, [38;5;241m3[39m: [38;5;124m"[39m[38;5;124mHigher[39m[38;5;124m"[39m, [38;5;241m4[39m: [38;5;124m"[39m[38;5;124mHigher[39m[38;5;124m"[39m}

Cell [0;32mIn[7], line 3[0m, in [0;36mcreate_sunburst_plot[0;34m(df, education_col, drug_cols, subplot_titles)[0m
[1;32m      1[0m [38;5;28;01mdef[39;00m [38;5;21mcreate_sunburst_plot[39m(df, education_col, drug_cols, subplot_titles):
[1;32m      2[0m     [38;5;66;03m# Creating a subplot figure with 1 row and 2 columns[39;00m
[0;32m----> 3[0m     fig [38;5;241m=[39m make_subplots(rows[38;5;241m=[39m[38;5;241m1[39m, cols[38;5;241m=[39m[38;5;241m2[39m, specs[38;5;241m=[39m[[{[38;5;124m"[39m[38;5;124mtype[39m[38;5;124m"[39m: [38;5;124m"[39m[38;5;124msunburst[39m[38;5;124m"[39m}, {[38;5;124m"[39m[38;5;124mtype[39m[38;5;124m"[39m: [38;5;124m"[39m[38;5;124msunburst[39m[38;5;124m"[39m}]])
[1;32m      5[0m     [38;5;66;03m# Hover template[39;00m
[1;32m      6[0m     hover_template [38;5;241m=[39m [38;5;124m'[39m[38;5;124m<b>[39m[38;5;124m%[39m[38;5;132;01m{label}[39;00m[38;5;124m:</b> [39m[38;5;124m%[39m[38;5;132;01m{percentParent:.1%}[39;00m[38;5;124m'[39m

[0;31mNameError[0m: name 'make_subplots' is not defined
NameError: name 'make_subplots' is not defined

